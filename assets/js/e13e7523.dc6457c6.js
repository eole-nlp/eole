"use strict";(self.webpackChunkdocusaurus_tsx=self.webpackChunkdocusaurus_tsx||[]).push([[7948],{3856:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>i,metadata:()=>t,toc:()=>a});var s=r(4848),l=r(8453);const i={},o="Prediction",t={id:"reference/Core API/inference",title:"Prediction",description:"Predictions",source:"@site/docs/reference/Core API/2_inference.md",sourceDirName:"reference/Core API",slug:"/reference/Core API/inference",permalink:"/eole/docs/reference/Core API/inference",draft:!1,unlisted:!1,editUrl:"https://github.com/eole-nlp/eole/tree/main/docs/docs/reference/Core API/2_inference.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{},sidebar:"apiSidebar",previous:{title:"Data Loaders",permalink:"/eole/docs/reference/Core API/dataloaders"},next:{title:"Bibliography",permalink:"/eole/docs/reference/bibliography"}},c={},a=[{value:"Predictions",id:"predictions",level:2},{value:"<em>class</em> eole.predict.prediction.PredictionBuilder(vocabs, n_best=1, replace_unk=False, phrase_table=&#39;&#39;, tgt_eos_idx=None, id_tokenization=False)",id:"class-eolepredictpredictionpredictionbuildervocabs-n_best1-replace_unkfalse-phrase_table-tgt_eos_idxnone-id_tokenizationfalse",level:3},{value:"Predictor Classes",id:"predictor-classes",level:2},{value:"<em>class</em> eole.predict.inference.Inference(model, vocabs, gpu=-1, n_best=1, min_length=0, max_length=100, max_length_ratio=1.5, ratio=0.0, beam_size=30, top_k=0, top_p=0.0, temperature=1.0, stepwise_penalty=None, dump_beam=False, block_ngram_repeat=0, ignore_when_blocking=frozenset({}), replace_unk=False, ban_unk_token=False, tgt_file_prefix=False, phrase_table=&#39;&#39;, data_type=&#39;text&#39;, verbose=False, report_time=False, global_scorer=None, report_align=False, gold_align=False, report_score=True, logger=None, seed=-1, with_score=False, estim_only=False, return_gold_log_probs=False, add_estimator=False, estimator_type=&#39;average&#39;, optional_eos=[], id_tokenization=False, image_token_id=10, fuse_kvq=False, fuse_gate=False)",id:"class-eolepredictinferenceinferencemodel-vocabs-gpu-1-n_best1-min_length0-max_length100-max_length_ratio15-ratio00-beam_size30-top_k0-top_p00-temperature10-stepwise_penaltynone-dump_beamfalse-block_ngram_repeat0-ignore_when_blockingfrozenset-replace_unkfalse-ban_unk_tokenfalse-tgt_file_prefixfalse-phrase_table-data_typetext-verbosefalse-report_timefalse-global_scorernone-report_alignfalse-gold_alignfalse-report_scoretrue-loggernone-seed-1-with_scorefalse-estim_onlyfalse-return_gold_log_probsfalse-add_estimatorfalse-estimator_typeaverage-optional_eos-id_tokenizationfalse-image_token_id10-fuse_kvqfalse-fuse_gatefalse",level:3},{value:"<em>classmethod</em> from_config(model, vocabs, config, model_config, device_id=0, global_scorer=None, report_align=False, report_score=True, logger=None)",id:"classmethod-from_configmodel-vocabs-config-model_config-device_id0-global_scorernone-report_alignfalse-report_scoretrue-loggernone",level:4},{value:"predict_batch(batch, attn_debug)",id:"predict_batchbatch-attn_debug",level:4},{value:"Decoding Strategies",id:"decoding-strategies",level:2},{value:"eole.predict.greedy_search.sample_with_temperature(logits, temperature, top_k, top_p)",id:"eolepredictgreedy_searchsample_with_temperaturelogits-temperature-top_k-top_p",level:3},{value:"Scoring",id:"scoring",level:2},{value:"<em>class</em> eole.predict.penalties.PenaltyBuilder(cov_pen, length_pen)",id:"class-eolepredictpenaltiespenaltybuildercov_pen-length_pen",level:3},{value:"coverage_none(cov, beta=0.0)",id:"coverage_nonecov-beta00",level:4},{value:"coverage_summary(cov, beta=0.0)",id:"coverage_summarycov-beta00",level:4},{value:"coverage_wu(cov, beta=0.0)",id:"coverage_wucov-beta00",level:4},{value:"length_average(cur_len, alpha=1.0)",id:"length_averagecur_len-alpha10",level:4},{value:"length_none(cur_len, alpha=0.0)",id:"length_nonecur_len-alpha00",level:4},{value:"length_wu(cur_len, alpha=0.0)",id:"length_wucur_len-alpha00",level:4}];function d(e){const n={code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"prediction",children:"Prediction"}),"\n",(0,s.jsx)(n.h2,{id:"predictions",children:"Predictions"}),"\n",(0,s.jsxs)(n.h3,{id:"class-eolepredictpredictionpredictionbuildervocabs-n_best1-replace_unkfalse-phrase_table-tgt_eos_idxnone-id_tokenizationfalse",children:[(0,s.jsx)(n.em,{children:"class"})," eole.predict.prediction.PredictionBuilder(vocabs, n_best=1, replace_unk=False, phrase_table='', tgt_eos_idx=None, id_tokenization=False)"]}),"\n",(0,s.jsxs)(n.p,{children:["Bases: ",(0,s.jsx)(n.code,{children:"object"})]}),"\n",(0,s.jsx)(n.p,{children:"Build a word-based prediction from the batch output\nof predictor and the underlying dictionaries."}),"\n",(0,s.jsx)(n.p,{children:"Replacement based on \u201cAddressing the Rare Word\nProblem in Neural Machine Translation\u201d []"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Parameters:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"(****)"})," (",(0,s.jsx)(n.em,{children:"vocabs"}),")"]}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.strong,{children:"(****)"})}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"n_best"})," (",(0,s.jsx)(n.em,{children:"int"}),") \u2013 number of predictions produced"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"replace_unk"})," (",(0,s.jsx)(n.em,{children:"bool"}),") \u2013 replace unknown words using attention"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"predictor-classes",children:"Predictor Classes"}),"\n",(0,s.jsxs)(n.h3,{id:"class-eolepredictinferenceinferencemodel-vocabs-gpu-1-n_best1-min_length0-max_length100-max_length_ratio15-ratio00-beam_size30-top_k0-top_p00-temperature10-stepwise_penaltynone-dump_beamfalse-block_ngram_repeat0-ignore_when_blockingfrozenset-replace_unkfalse-ban_unk_tokenfalse-tgt_file_prefixfalse-phrase_table-data_typetext-verbosefalse-report_timefalse-global_scorernone-report_alignfalse-gold_alignfalse-report_scoretrue-loggernone-seed-1-with_scorefalse-estim_onlyfalse-return_gold_log_probsfalse-add_estimatorfalse-estimator_typeaverage-optional_eos-id_tokenizationfalse-image_token_id10-fuse_kvqfalse-fuse_gatefalse",children:[(0,s.jsx)(n.em,{children:"class"})," eole.predict.inference.Inference(model, vocabs, gpu=-1, n_best=1, min_length=0, max_length=100, max_length_ratio=1.5, ratio=0.0, beam_size=30, top_k=0, top_p=0.0, temperature=1.0, stepwise_penalty=None, dump_beam=False, block_ngram_repeat=0, ignore_when_blocking=frozenset({}), replace_unk=False, ban_unk_token=False, tgt_file_prefix=False, phrase_table='', data_type='text', verbose=False, report_time=False, global_scorer=None, report_align=False, gold_align=False, report_score=True, logger=None, seed=-1, with_score=False, estim_only=False, return_gold_log_probs=False, add_estimator=False, estimator_type='average', optional_eos=[], id_tokenization=False, image_token_id=10, fuse_kvq=False, fuse_gate=False)"]}),"\n",(0,s.jsxs)(n.p,{children:["Bases: ",(0,s.jsx)(n.code,{children:"object"})]}),"\n",(0,s.jsx)(n.p,{children:"Predict a batch of sentences with a saved model."}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Parameters:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"model"})," (",(0,s.jsx)(n.em,{children:"eole.modules.BaseModel"}),") \u2013 Model to use for prediction"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"vocabs"})," (",(0,s.jsx)(n.em,{children:"dict"})," *[*",(0,s.jsx)(n.em,{children:"str"})," ",(0,s.jsx)(n.em,{children:","})," ",(0,s.jsx)(n.em,{children:"Vocab"})," ",(0,s.jsx)(n.em,{children:"]"}),") \u2013 A dict\nmapping each side\u2019s Vocab."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"gpu"})," (",(0,s.jsx)(n.em,{children:"int"}),") \u2013 GPU device. Set to negative for no GPU."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"n_best"})," (",(0,s.jsx)(n.em,{children:"int"}),") \u2013 How many beams to wait for."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"min_length"})," (",(0,s.jsx)(n.em,{children:"int"}),") \u2013 See\n",(0,s.jsx)(n.code,{children:"eole.predict.decode_strategy.DecodeStrategy"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"max_length"})," (",(0,s.jsx)(n.em,{children:"int"}),") \u2013 See\n",(0,s.jsx)(n.code,{children:"eole.predict.decode_strategy.DecodeStrategy"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"beam_size"})," (",(0,s.jsx)(n.em,{children:"int"}),") \u2013 Number of beams."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"top_p"})," (",(0,s.jsx)(n.em,{children:"float"}),") \u2013 See\n",(0,s.jsx)(n.code,{children:"eole.predict.greedy_search.GreedySearch"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"top_k"})," (",(0,s.jsx)(n.em,{children:"int"}),") \u2013 See\n",(0,s.jsx)(n.code,{children:"eole.predict.greedy_search.GreedySearch"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"temperature"})," (",(0,s.jsx)(n.em,{children:"float"}),") \u2013 See\n",(0,s.jsx)(n.code,{children:"eole.predict.greedy_search.GreedySearch"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"stepwise_penalty"})," (",(0,s.jsx)(n.em,{children:"bool"}),") \u2013 Whether coverage penalty is applied every step\nor not."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"dump_beam"})," (",(0,s.jsx)(n.em,{children:"bool"}),") \u2013 Debugging option."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"block_ngram_repeat"})," (",(0,s.jsx)(n.em,{children:"int"}),") \u2013 See\n",(0,s.jsx)(n.code,{children:"eole.predict.decode_strategy.DecodeStrategy"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"ignore_when_blocking"})," (",(0,s.jsx)(n.em,{children:"set"})," ",(0,s.jsx)(n.em,{children:"or"})," ",(0,s.jsx)(n.em,{children:"frozenset"}),") \u2013 See\n",(0,s.jsx)(n.code,{children:"eole.predict.decode_strategy.DecodeStrategy"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"replace_unk"})," (",(0,s.jsx)(n.em,{children:"bool"}),") \u2013 Replace unknown token."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"tgt_file_prefix"})," (",(0,s.jsx)(n.em,{children:"bool"}),") \u2013 Force the predictions begin with provided -tgt."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"data_type"})," (",(0,s.jsx)(n.em,{children:"str"}),") \u2013 Source data type."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"verbose"})," (",(0,s.jsx)(n.em,{children:"bool"}),") \u2013 Print/log every prediction."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"report_time"})," (",(0,s.jsx)(n.em,{children:"bool"}),") \u2013 Print/log total time/frequency."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"global_scorer"})," (",(0,s.jsx)(n.em,{children:"eole.predict.GNMTGlobalScorer"}),") \u2013 Prediction\nscoring/reranking object."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"report_score"})," (",(0,s.jsx)(n.em,{children:"bool"}),") \u2013 Whether to report scores"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"logger"})," (",(0,s.jsx)(n.em,{children:"logging.Logger"})," ",(0,s.jsx)(n.em,{children:"or"})," ",(0,s.jsx)(n.em,{children:"NoneType"}),") \u2013 Logger."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.h4,{id:"classmethod-from_configmodel-vocabs-config-model_config-device_id0-global_scorernone-report_alignfalse-report_scoretrue-loggernone",children:[(0,s.jsx)(n.em,{children:"classmethod"})," from_config(model, vocabs, config, model_config, device_id=0, global_scorer=None, report_align=False, report_score=True, logger=None)"]}),"\n",(0,s.jsx)(n.p,{children:"Alternate constructor."}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Parameters:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"model"})," (",(0,s.jsx)(n.em,{children:"eole.modules.BaseModel"}),") \u2013 See ",(0,s.jsx)(n.code,{children:"__init__()"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"vocabs"})," (",(0,s.jsx)(n.em,{children:"dict"})," *[*",(0,s.jsx)(n.em,{children:"str"})," ",(0,s.jsx)(n.em,{children:","})," ",(0,s.jsx)(n.em,{children:"Vocab"})," ",(0,s.jsx)(n.em,{children:"]"}),") \u2013 See\n",(0,s.jsx)(n.code,{children:"__init__()"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"opt"})," (",(0,s.jsx)(n.em,{children:"argparse.Namespace"}),") \u2013 Command line options"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"model_opt"})," (",(0,s.jsx)(n.em,{children:"argparse.Namespace"}),") \u2013 Command line options saved with\nthe model checkpoint."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"global_scorer"})," (",(0,s.jsx)(n.em,{children:"eole.predict.GNMTGlobalScorer"}),") \u2013 See\n",(0,s.jsx)(n.code,{children:"__init__()"}),".."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"report_align"})," (",(0,s.jsx)(n.em,{children:"bool"}),") \u2013 See ",(0,s.jsx)(n.code,{children:"__init__()"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"report_score"})," (",(0,s.jsx)(n.em,{children:"bool"}),") \u2013 See ",(0,s.jsx)(n.code,{children:"__init__()"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"logger"})," (",(0,s.jsx)(n.em,{children:"logging.Logger"})," ",(0,s.jsx)(n.em,{children:"or"})," ",(0,s.jsx)(n.em,{children:"NoneType"}),") \u2013 See ",(0,s.jsx)(n.code,{children:"__init__()"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"predict_batchbatch-attn_debug",children:"predict_batch(batch, attn_debug)"}),"\n",(0,s.jsx)(n.p,{children:"Predict a batch of sentences."}),"\n",(0,s.jsx)(n.h2,{id:"decoding-strategies",children:"Decoding Strategies"}),"\n",(0,s.jsx)(n.h3,{id:"eolepredictgreedy_searchsample_with_temperaturelogits-temperature-top_k-top_p",children:"eole.predict.greedy_search.sample_with_temperature(logits, temperature, top_k, top_p)"}),"\n",(0,s.jsx)(n.p,{children:"Select next tokens randomly from the top k possible next tokens."}),"\n",(0,s.jsxs)(n.p,{children:["Samples from a categorical distribution over the ",(0,s.jsx)(n.code,{children:"top_k"})," words using\nthe category probabilities ",(0,s.jsx)(n.code,{children:"logits / temperature"}),"."]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Parameters:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"logits"})," (",(0,s.jsx)(n.em,{children:"FloatTensor"}),") \u2013 Shaped ",(0,s.jsx)(n.code,{children:"(batch_size, vocab_size)"}),".\nThese can be logits (",(0,s.jsx)(n.code,{children:"(-inf, inf)"}),") or log-probs (",(0,s.jsx)(n.code,{children:"(-inf, 0]"}),").\n(The distribution actually uses the log-probabilities\n",(0,s.jsx)(n.code,{children:"logits - logits.logsumexp(-1)"}),", which equals the logits if\nthey are log-probabilities summing to 1.)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"temperature"})," (",(0,s.jsx)(n.em,{children:"float"}),") \u2013 Used to scale down logits. The higher the\nvalue, the more likely it is that a non-max word will be\nsampled."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"top_k"})," (",(0,s.jsx)(n.em,{children:"int"}),") \u2013 This many words could potentially be chosen. The\nother logits are set to have probability 0."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"top_p"})," (",(0,s.jsx)(n.em,{children:"float"}),") \u2013 Keep most likely words until the cumulated\nprobability is greater than p. If used with top_k: both\nconditions will be applied"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Returns:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["topk_ids: Shaped ",(0,s.jsx)(n.code,{children:"(batch_size, 1)"}),". These are\nthe sampled word indices in the output vocab."]}),"\n",(0,s.jsxs)(n.li,{children:["topk_scores: Shaped ",(0,s.jsx)(n.code,{children:"(batch_size, 1)"}),". These\nare essentially ",(0,s.jsx)(n.code,{children:"(logits / temperature)[topk_ids]"}),"."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Return type:"}),"\n(LongTensor, FloatTensor)"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"scoring",children:"Scoring"}),"\n",(0,s.jsxs)(n.h3,{id:"class-eolepredictpenaltiespenaltybuildercov_pen-length_pen",children:[(0,s.jsx)(n.em,{children:"class"})," eole.predict.penalties.PenaltyBuilder(cov_pen, length_pen)"]}),"\n",(0,s.jsxs)(n.p,{children:["Bases: ",(0,s.jsx)(n.code,{children:"object"})]}),"\n",(0,s.jsx)(n.p,{children:"Returns the Length and Coverage Penalty function for Beam Search."}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Parameters:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"length_pen"})," (",(0,s.jsx)(n.em,{children:"str"}),") \u2013 option name of length pen"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"cov_pen"})," (",(0,s.jsx)(n.em,{children:"str"}),") \u2013 option name of cov pen"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Variables:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"has_cov_pen"})," (",(0,s.jsx)(n.em,{children:"bool"}),") \u2013 Whether coverage penalty is None (applying it\nis a no-op). Note that the converse isn\u2019t true. Setting beta\nto 0 should force coverage length to be a no-op."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"has_len_pen"})," (",(0,s.jsx)(n.em,{children:"bool"}),") \u2013 Whether length penalty is None (applying it\nis a no-op). Note that the converse isn\u2019t true. Setting alpha\nto 1 should force length penalty to be a no-op."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"coverage_penalty"})," (",(0,s.jsx)(n.em,{children:"callable"})," ",(0,s.jsx)(n.em,{children:"["})," *[*",(0,s.jsx)(n.em,{children:"FloatTensor"})," ",(0,s.jsx)(n.em,{children:","})," ",(0,s.jsx)(n.em,{children:"float"})," ",(0,s.jsx)(n.em,{children:"]"})," ",(0,s.jsx)(n.em,{children:","})," ",(0,s.jsx)(n.em,{children:"FloatTensor"})," ",(0,s.jsx)(n.em,{children:"]"}),") \u2013 Calculates the coverage penalty."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"length_penalty"})," (",(0,s.jsx)(n.em,{children:"callable"})," ",(0,s.jsx)(n.em,{children:"["})," *[*",(0,s.jsx)(n.em,{children:"int"})," ",(0,s.jsx)(n.em,{children:","})," ",(0,s.jsx)(n.em,{children:"float"})," ",(0,s.jsx)(n.em,{children:"]"})," ",(0,s.jsx)(n.em,{children:","})," ",(0,s.jsx)(n.em,{children:"float"})," ",(0,s.jsx)(n.em,{children:"]"}),") \u2013 Calculates\nthe length penalty."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"coverage_nonecov-beta00",children:"coverage_none(cov, beta=0.0)"}),"\n",(0,s.jsx)(n.p,{children:"Returns zero as penalty"}),"\n",(0,s.jsx)(n.h4,{id:"coverage_summarycov-beta00",children:"coverage_summary(cov, beta=0.0)"}),"\n",(0,s.jsx)(n.p,{children:"Our summary penalty."}),"\n",(0,s.jsx)(n.h4,{id:"coverage_wucov-beta00",children:"coverage_wu(cov, beta=0.0)"}),"\n",(0,s.jsx)(n.p,{children:"GNMT coverage re-ranking score."}),"\n",(0,s.jsxs)(n.p,{children:["See \u201cGoogle\u2019s Neural Machine Translation System\u201d [].\n",(0,s.jsx)(n.code,{children:"cov"})," is expected to be sized ",(0,s.jsx)(n.code,{children:"(*, seq_len)"}),", where ",(0,s.jsx)(n.code,{children:"*"})," is\nprobably ",(0,s.jsx)(n.code,{children:"batch_size x beam_size"})," but could be several\ndimensions like ",(0,s.jsx)(n.code,{children:"(batch_size, beam_size)"}),". If ",(0,s.jsx)(n.code,{children:"cov"})," is attention,\nthen the ",(0,s.jsx)(n.code,{children:"seq_len"})," axis probably sums to (almost) 1."]}),"\n",(0,s.jsx)(n.h4,{id:"length_averagecur_len-alpha10",children:"length_average(cur_len, alpha=1.0)"}),"\n",(0,s.jsx)(n.p,{children:"Returns the current sequence length."}),"\n",(0,s.jsx)(n.h4,{id:"length_nonecur_len-alpha00",children:"length_none(cur_len, alpha=0.0)"}),"\n",(0,s.jsx)(n.p,{children:"Returns unmodified scores."}),"\n",(0,s.jsx)(n.h4,{id:"length_wucur_len-alpha00",children:"length_wu(cur_len, alpha=0.0)"}),"\n",(0,s.jsx)(n.p,{children:"GNMT length re-ranking score."}),"\n",(0,s.jsx)(n.p,{children:"See \u201cGoogle\u2019s Neural Machine Translation System\u201d []."})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>o,x:()=>t});var s=r(6540);const l={},i=s.createContext(l);function o(e){const n=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:o(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);